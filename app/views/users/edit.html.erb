<h2>Edit User Account</h2>

<% @user.password = @user.password_confirmation = nil %>

<% form_for :user, :url => user_path, :html => { :method => :put } do |f| -%>
  <%= error_messages_for :user %>
  <p><label for="name">Name</label>: <%=h @user.full_name %></p>

  <p>
  <%= f.label :email %>
  <%= error_message_on :user, :email, :append_text => '.' %><br/>
  <%= f.text_field :email %>
  </p>

  <p><label for="password">Password</label><br/>
  <%= f.password_field :password %>
  </p>

  <p><label for="password_confirmation">Confirm Password</label><br/>
  <%= f.password_field :password_confirmation %>
  </p>

  <p>
  <%= f.label :security_question %>
  <% if @user.errors.on(:security_question).nil? -%>(minimum 5 characters)<% end -%>
  <%= error_message_on :user, :security_question, :append_text => '.' %>
  <br/>
  <%= f.text_field :security_question, :size => 80 %>
  </p>

  <p>
  <%= f.label :security_answer %>
  <% if @user.errors.on(:security_answer).nil? -%><% end -%>
  <%= error_message_on :user, :security_answer, :append_text => '.' %>
  <br/>
  <%= f.text_field :security_answer, :size => 80 %>
  </p>
<p>
<% if current_user.has_completed?('named_proxies') %>
  <%= link_to 'Manage designated proxies', named_proxies_path %>
<% end %>
</p>
<h2>Manage mailing list subscriptions</h2>
<table class="admin_table">
  <tr>
    <th>Name</th>
    <th>Subscribed</th>
  </tr>
  <% @mailing_lists.each do |mailing_list| -%>
    <tr class="<%= cycle 'even', 'odd' %>">
      <td><%=h mailing_list.name %></td>
      <td>
        <%= check_box_tag "user[mailing_list_ids][]", mailing_list.id, @user.mailing_list_ids.include?(mailing_list.id) -%> <%= mailing_list.name -%>
      </td>
    </tr>
  <% end %>
</table>

  <p><%= submit_tag 'Save Changes' %></p>
<% end -%>

<% unless @user.authsub_token.blank? %>
<h2>Unlink my Google Health account</h2>
<p>If you wish to stop sharing your Google Health information, click below to unlink your health profile:</p>
<%= button_to 'Unlink Google Health profile',
              :controller => 'phrccr',
              :action => 'unlink_googlehealth' %>
<% end %>

<h2>Delete my account</h2>
<p>If you would like to delete your account, click below to request an account deletion:</p>
<%= button_to 'Delete my account',
              user_url(@user),
              :confirm => 'Are you sure?  This will send an email requestion an account deletion.  A PGP administrator will remove your account.',
              :method => 'delete' %>
