<h2>Google surveys</h2>

<table class="admin_table">
  <thead>
    <tr>
      <th>Survey name</th>
      <th>Researcher</th>
      <% if current_user %><th>OAuth service</th><% end %>
      <th>Responses retrieved</th>
      <th>Responses</th>
      <th>Participants</th>
      <th></th>
      <% if current_user and (current_user.is_researcher? or current_user.is_admin?) %>
      <th></th>
      <th></th>
      <% end %>
    </tr>
  </thead>
  <tbody>

    <% @google_surveys.each do |google_survey| %>
    <tr>
      <td><%= link_to google_survey.name, google_survey %></td>
      <td><%= google_survey.user.full_name %></td>
      <% if current_user %><td><%= google_survey.oauth_service.name %></td><% end %>
      <td><%= google_survey.last_downloaded_at %></td>
      <td><%= google_survey.responses.size %></td>
      <td><%= google_survey.responses.collect(&:owner_id).uniq.size %></td>
      <td><%= link_to 'Download responses (CSV)', download_google_survey_path(google_survey) if google_survey.last_downloaded_at and google_survey.is_result_public %></td>
      <% if current_user and (current_user.is_researcher? or current_user.is_admin?) %>
      <td><%= link_to 'Edit', edit_google_survey_path(google_survey) if current_user.is_admin? or current_user.id == google_survey.user.id %></td>
      <td><%= button_to 'Destroy', google_survey, :confirm => 'Are you sure?', :method => :delete if current_user.is_admin? or current_user.id == google_survey.user.id %></td>
      <% end %>
    </tr>
    <% end %>

  </tbody>
</table>

<br />

<%= link_to 'New Google survey', new_google_survey_path unless @min_view %>
