<% if @user == nil -%>

  <h3>Unknown user</h3>

  <p>Sorry, this user does not exist.</p>

  <p>Interested in enrolling in the PGP? <a href="http://www.personalgenomes.org/signup.html">Sign-up here</a>.</p>
  
<% else -%>

<h2>Public Profile -- <%= @user.hex -%></h2>

<div align="right">Public profile url: <%= link_to public_profile_url_string(@user), public_profile_path(:hex => @user.hex) %></div>

<h3>Google Health <% if logged_in? and @user == current_user -%><%= link_to "[edit]", phrccr_path %><% end -%></h3>
<% if @ccr != nil -%>
<div class="admin_table">
<%= render :partial => "phrccrs/ccr" %>
</div>
<% else -%>
None added.
<% end -%>

<h3>Genetic data <% if logged_in? and @user == current_user -%><%= link_to "[edit]", genetic_data_index_path() %><% end -%></h3>

<% if (@user.genetic_data.size > 0) -%>

<table class="admin_table">
  <tr>
    <th>Date</th>
    <th>Data Type</th>
    <th>Name</th>
    <th>&nbsp;</th>
  </tr>
  <% @user.genetic_data.each do |g| -%>
    <tr class="<%= cycle 'even', 'odd' %>">
      <td><%=h g.date %></td>
      <td><%=h g.data_type %></td>
      <td><%=h g.name %></td>
      <td><%= link_to 'Download', genetic_data_download_path(g.id) %></td>
    </tr>
  <% end %>
</table>
<% else -%>
None available.
<% end -%>

<h3>Geographic Information <% if logged_in? and @user == current_user -%><%= link_to "[edit]", edit_geographic_information_path(@user) %><% end -%></h3>

<% if (@user.state != '' and not @user.state.nil?) or (@user.zip != '' and not @user.zip.nil?) -%>

<table class="admin_table">
<% if @user.state != '' -%>
<tr><td>State:</td><td><%= Carmen::state_name(@user.state.to_s,'US') -%></td></tr>
<% end -%>
<% if @user.zip != '' -%>
<tr><td>Zip code:</td><td><%= @user.zip.to_s -%></td></tr>
<% end -%>
</table>

<% else -%>
Not added.
<% end -%>

<h3>Family Members Enrolled <% if logged_in? and @user == current_user -%><%= link_to "[edit]", family_relations_path %><% end -%></h3>
<% if @family_members && @family_members != []%>
<table class="admin_table">
  <% @family_members.find_all{|f| f.is_confirmed}.each do |fm| -%>
    <tr>
      <td>
        <%= link_to fm.relation, public_profile_path(fm.relative.hex) %>
      </td>
      <td>linked <%= h fm.updated_at %></td>
    </tr>
  <% end %>
</table>
<% else %>
None added.
<% end %>

<h3>Completed Surveys</h3>
<% unless @google_survey_results.empty? %>
<div class="profile-data">
<table>
  <tbody>
    <% @google_survey_results.each {|survey_result| %>
    <tr>
      <th>
	<%= link_to_if logged_in?, survey_result[:survey].name, google_survey_path(survey_result[:survey]) %>
      </th>
      <td>
	Responses collected <%= survey_result[:nonce].used_at %>.
	<a href="#" onclick="jQuery('.survey_result_<%= survey_result[:nonce].id %>').toggle(); jQuery(this).html(jQuery('.survey_result_<%= survey_result[:nonce].id %>').is(':visible') ? 'Hide responses' : 'Show responses'); return false;">Show responses</a>
      </td>
    </tr>
    <% survey_result[:answers].each {|answer| %>
    <% if answer.answer and answer.column != survey_result[:survey].userid_response_column %>
    <tr class="survey_result_<%= survey_result[:nonce].id %> ui-helper-hidden">
      <td><%= answer.google_survey_question.question %></td>
      <td class="hoverable"><%= answer.answer %></td>
    </tr>
    <% end %>
    <% } %>
  </tbody>
</table>
<% } %>
</div>
<% else %>
None completed.
<% end %>

<h3>Absolute Pitch Survey
<% if @user.absolute_pitch_survey_completion.nil? && @user == current_user %>
<%= link_to "[take survey]", "/absolute_pitch_surveys" %>
<% elsif !@user.absolute_pitch_survey_completion.nil? && @user == current_user %>
<%= link_to "[see all responses/retake survey]", review_absolute_pitch_surveys_path(@user.hex) %>
<% elsif !@user.absolute_pitch_survey_completion.nil? %>
<%= link_to "[see all responses]", review_absolute_pitch_surveys_path(@user.hex) %>
<% end %>
</h3>
<% if @user.absolute_pitch_survey_completion.nil? %>
Survey not taken.
<% else %>
<% @absolute_pitch_questions.each{ |q| %>
  <% if q.question_type != 'end' %>
    <div><%= q.text %> <span style="font-weight:bold"><%= @absolute_pitch_answers[q.id] %></span></div>
  <% end %>
<% } %>
<% end %>
<%= render :partial => 'enrollment_history' %>

<% end -%>


