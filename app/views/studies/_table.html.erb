<table class="admin_table">
  <tr>
    <th>Name</th>
    <th>Researcher</th>
    <th>IRB associate</th>
    <th>U</th>
    <th>I</th>
    <th>NI</th>
    <th>A</th>
    <th>NA</th>
    <th>R</th>
    <th>Samples</th>
    <th></th>
    <th></th>
  </tr>
  <% @studies.sort { |a,b| a.name <=> b.name }.each do |study| %>
    <tr class="<%= cycle 'even', 'odd' %>">
      <td><%= (can?(:update, study) ? ( link_to study.name, edit_collection_event_url(study) ) : study.name ) %></td>
      <td><%= study.researcher.full_name %></td>
      <td>
          <% if study.irb_associate.nil? then %>
            <%= (can?(:update, study) ? ( link_to 'unassigned', edit_collection_event_url(study) ) : study.name ) %>
          <% else %>
            <%= study.irb_associate.full_name %>
          <% end %>
      </td>
      <td><%= link_to(study.study_participants.undecided.count, study_users_path(study, :format => 'csv', :type => 'undecided')) %></td>
      <td><%= link_to(study.study_participants.interested.count, study_users_path(study, :format => 'csv', :type => 'interested')) %></td>
      <td><%= link_to(study.study_participants.not_interested.count, study_users_path(study, :format => 'csv', :type => 'not_interested')) %></td>
      <td><%= link_to(study.study_participants.accepted.count, study_users_path(study, :format => 'csv', :type => 'accepted')) %></td>
      <td><%= link_to(study.study_participants.not_accepted.count, study_users_path(study, :format => 'csv', :type => 'not_accepted')) %></td>
      <td><%= link_to(study.study_participants.removed.count, study_users_path(study, :format => 'csv', :type => 'removed')) %></td>
      <td>
      <% if !(samples = Sample.find_all_by_study_id(study.id)).empty? %>
	<%= link_to("#{samples.size}", samples_path(:study_id => study.id, :format => 'csv')) %>
      <% end %>
      </td>
      <td><%= link_to('map', study_map_path(study)) %></td>
      <% if study.approved %>
      <td><%= link_to('Manage participants', study_users_path(study)) %></td>
      <% end %>
    </tr>
  <% end %>
</table>
