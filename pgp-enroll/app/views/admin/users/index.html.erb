<h2>Users</h2>

<h3>Users per day</h3>
<p>
  <img src="<%= UserReport.users_per_day_chart_url %>" />
</p>

<h3>Filter users</h3>
<% form_tag admin_users_path, { :method => 'get' } do  %>
  <ul>
    <li><%= link_to "Show all users", admin_users_path %></li>
    <li>
      <label for="completed">Show users who have completed enrollment step:</label>
      <%= select_tag 'completed',
          options_for_select(EnrollmentStep.ordered.all.map { |es| ["##{es.ordinal} (#{User.has_completed(es.keyword).count} users) - #{es.title} ", es.keyword] },
                             params[:completed])%>
      <%= submit_tag 'Show' %>
    </li>
  </ul>
<% end %>

<p>Download list of users as <%= link_to 'CSV', formatted_admin_users_url(:format => 'csv', :completed => params[:completed]) %></p>

<table class="admin_table">
  <tr>
    <th>Name</th><th>Email</th><th>Content Areas</th><th>Active?</th><th>Is Admin?</th><th>Edit</th><th>Delete</th><th>Activate</th><th>Current step</th><th>Promote to next enrollment step</th>
  </tr>
  <% @users.each do |user| -%>
    <tr class="<%= cycle 'even', 'odd' %>">
      <td><%=h user.full_name %></td>
      <td><%=h user.email %></td>
      <td><%= user.completed_content_area_count %> / <%= ContentArea.count %> (<%= link_to 'Details', admin_user_exam_responses_path(user) %>)</td>
      <td><%=  user.active? %></td>
      <td><%=  user.is_admin? %></td>
      <td><%= link_to 'Edit', edit_admin_user_url(user) %></td>
      <td><%= link_to 'Delete', admin_user_url(user),
                :method => 'DELETE',
                :confirm => 'Are you sure you want to delete this user?' %></td>
      <td><%= link_to 'Activate', activate_admin_user_url(user), :method => 'PUT' %></td>
      <td>
        <% if user.next_enrollment_step -%>
          #<%= user.next_enrollment_step.ordinal %>
        <% else -%>
          Finished
        <% end -%>
      </td>
      <td>
        <% if user.next_enrollment_step -%>
          <%= link_to 'Promote', promote_admin_user_url(user), :method => 'PUT' %>
        <% end -%>
      </td>
    </tr>
  <% end -%>
</table>
